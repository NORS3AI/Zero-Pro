/* responsive.css — Phase 4: Tablet & mobile layout */

/* ─── Shared drawer helper (used on tablet + mobile) ────────────────────────── */

/*
 * On screens narrower than 1024 px:
 *   - Inspector and AI panel become fixed right-side drawers.
 *   - A backdrop darkens the content behind any open drawer.
 * On screens narrower than 641 px (mobile):
 *   - Workspace becomes a single column.
 *   - Binder also becomes a fixed left-side drawer.
 *   - Toolbar compresses to icon-only for most buttons.
 */

/* ─── Safe-area insets (notch / home indicator on iOS) ──────────────────────── */
/*
 * Requires viewport-fit=cover in the <meta viewport> tag.
 * env() values are 0px on devices without a notch, so no visual change there.
 */

:root {
  --safe-top:    env(safe-area-inset-top,    0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left:   env(safe-area-inset-left,   0px);
  --safe-right:  env(safe-area-inset-right,  0px);
}

/* Toolbar: extend height and add side padding for notch/Dynamic Island */
#toolbar {
  padding-top:   var(--safe-top);
  padding-left:  max(10px, var(--safe-left));
  padding-right: max(10px, var(--safe-right));
  min-height:    calc(var(--toolbar-h) + var(--safe-top));
}

/* App grid: grow the toolbar row to absorb the safe-area-top */
#app {
  grid-template-rows: calc(var(--toolbar-h) + var(--safe-top)) 1fr;
}

/* Status bar: lift it above the home indicator */
#status-bar {
  padding-bottom: var(--safe-bottom);
  min-height:     calc(var(--statusbar-h) + var(--safe-bottom));
}

/* Drawers also respect the bottom safe area */
#inspector,
#ai-panel {
  padding-bottom: var(--safe-bottom);
}

/* ─── Drawer close buttons ───────────────────────────────────────────────────── */
/* Hidden on desktop; revealed when the drawer becomes an overlay */

.binder-drawer-close,
.inspector-drawer-close { display: none; }

/* ─── Touch-device improvements (hover: none means touchscreen) ─────────────── */

@media (hover: none) {
  /* Binder row action buttons (delete, rename) are hidden on hover — unusable
     on touch. Always show them on touch devices. */
  .binder-actions {
    opacity: 1;
  }

  .binder-action-btn {
    width: 28px;
    height: 28px;
  }

  .binder-action-btn svg {
    width: 13px;
    height: 13px;
  }
}

/* ─── Smooth momentum scrolling on iOS / Android ────────────────────────────── */

#binder-tree,
#editor-container,
.inspector-panel,
#corkboard-grid,
#outline-table-wrap {
  -webkit-overflow-scrolling: touch;
}

/* Prevent scroll from "escaping" a drawer and scrolling the page behind it */
#binder,
#inspector,
#ai-panel {
  overscroll-behavior: contain;
}

/* ─── Backdrop ───────────────────────────────────────────────────────────────── */

#mobile-backdrop {
  display: none;
  position: fixed;
  inset: var(--toolbar-h) 0 0 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 490;
  /* hidden by default; shown by JS adding open-drawer classes */
}

/* ─── Tablet  (≤ 1023 px) ────────────────────────────────────────────────────── */

@media (max-width: 1023px) {

  /* Slightly compress the toolbar */
  .toolbar-brand    { font-size: 14px; }
  .toolbar-project-title { max-width: 140px; }

  /* Inspector: hide from grid; becomes a fixed right drawer */
  #workspace {
    grid-template-columns: var(--binder-w) 1fr !important;
    --inspector-w: 0px;
    --ai-panel-w:  0px;
  }

  #inspector {
    position: fixed;
    top: calc(var(--toolbar-h) + var(--safe-top));
    right: 0;
    bottom: 0;
    width: 280px;
    transform: translateX(100%);
    transition: transform 220ms ease;
    z-index: 500;
    overflow-y: auto;
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.35);
  }

  #workspace.inspector-open #inspector {
    transform: translateX(0);
  }

  /* Show close button inside the inspector drawer */
  .inspector-drawer-close { display: flex; }

  /* AI panel: fixed right drawer */
  #ai-panel {
    position: fixed;
    top: calc(var(--toolbar-h) + var(--safe-top));
    right: 0;
    bottom: 0;
    width: min(320px, 90vw);
    transform: translateX(100%);
    transition: transform 220ms ease;
    z-index: 500;
    overflow: hidden;
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.35);
  }

  /* ai-open is toggled by ai.js via workspace class */
  #workspace.ai-open #ai-panel {
    transform: translateX(0);
  }

  /* Backdrop: show whenever a drawer is open */
  #workspace.inspector-open #mobile-backdrop,
  #workspace.ai-open         #mobile-backdrop {
    display: block;
  }

}

/* ─── Mobile (≤ 640 px) ──────────────────────────────────────────────────────── */

@media (max-width: 640px) {

  /* ── Toolbar: horizontally scrollable so all controls stay reachable ── */

  #toolbar {
    overflow-x: auto;
    overflow-y: hidden;
    flex-wrap: nowrap;
    scrollbar-width: none; /* Firefox */
    gap: 2px;
  }

  #toolbar::-webkit-scrollbar { display: none; }

  /* Spacer must not grow — otherwise it pushes right-side buttons off screen */
  .toolbar-spacer { flex: 0 0 auto; min-width: 8px; }

  /* ── Toolbar items ── */

  .toolbar-brand     { display: none; }

  /* Compress view-switcher to icon-only */
  .view-btn          { font-size: 0; padding: 6px 7px; }
  .view-btn svg      { width: 15px; height: 15px; }
  .view-btn span     { display: none; }

  /* Icon-only for Focus, Export, Ask AI */
  #btn-focus,
  #btn-export,
  #btn-ai            { font-size: 0; padding: 5px; width: 30px; height: 30px; justify-content: center; }
  #btn-focus svg,
  #btn-export svg,
  #btn-ai svg        { width: 15px; height: 15px; }

  /* Separator cleanup */
  .toolbar-sep:not(:first-of-type) { display: none; }

  /* ── Workspace: single column ── */

  #workspace {
    grid-template-columns: 1fr !important;
    --binder-w:    0px;
    --inspector-w: 0px;
    --ai-panel-w:  0px;
  }

  /* ── Binder: fixed left drawer ── */

  #binder {
    position: fixed;
    top: calc(var(--toolbar-h) + var(--safe-top));
    left: 0;
    bottom: 0;
    width: min(280px, 80vw);
    transform: translateX(-100%);
    transition: transform 220ms ease;
    z-index: 500;
    overflow: hidden;
    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.35);
  }

  #workspace.binder-open #binder {
    transform: translateX(0);
  }

  /* Show the binder close button on mobile */
  .binder-drawer-close { display: flex; }

  /* Backdrop: also covers binder-open on mobile */
  #workspace.binder-open    #mobile-backdrop,
  #workspace.inspector-open #mobile-backdrop,
  #workspace.ai-open        #mobile-backdrop {
    display: block;
  }

  /* ── Editor ── */

  #editor {
    padding: 24px 16px 60px;
    font-size: 16px;
  }

  #editor-placeholder {
    padding: 0 16px;
    font-size: 16px;
    top: 24px;
  }

  /* Formatting toolbar: scroll horizontally so all buttons are always accessible */
  #editor-toolbar {
    padding: 4px 6px;
    gap: 1px;
    overflow-x: auto;
    overflow-y: hidden;
    flex-wrap: nowrap;
    scrollbar-width: none; /* Firefox */
  }

  #editor-toolbar::-webkit-scrollbar { display: none; }

  .fmt-btn { width: 32px; height: 32px; flex-shrink: 0; }

  /* ── Corkboard: two-column grid ── */

  #corkboard-grid {
    padding: 12px;
    gap: 12px;
    --card-w: calc(50vw - 20px); /* two cards per row */
  }

  #corkboard-toolbar { padding: 5px 12px; gap: 8px; }
  .cork-zoom-label   { display: none; }
  #cork-zoom         { width: 60px; }

  /* ── Outline: horizontal scroll to preserve all columns ── */

  #outline-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  #outline-table      { min-width: 480px; }

  /* ── Toast: position above the status bar ── */

  .toast {
    bottom: calc(var(--statusbar-h) + 16px + var(--safe-bottom));
  }

  /* ── Touch targets ── */

  .binder-item-row   { min-height: 36px; }
  .binder-action-btn { width: 28px; height: 28px; }
}

/* ─── Very narrow screens (≤ 400 px) — single corkboard column ──────────────── */

@media (max-width: 400px) {
  #corkboard-grid {
    --card-w: calc(100vw - 24px);
  }
}
